<<<<<<< HEAD
# needed to make qseecomd work in recovery
on init
    chmod 0660 /dev/qseecom
    chown system drmrpc /dev/qseecom
    chmod 0664 /dev/ion
    chown system system /dev/ion
    #install_keyring
    #init_user0
    #unlock_user0_key

# separate copy needed to use /sbin/linker64 instead of /system/bin/linker64
service sbinqseecomd /sbin/qseecomd
    oneshot
    disabled
    user root
    group root
    seclabel u:r:recovery:s0

#on property:ro.crypto.state=encrypted
on boot
    start sbinqseecomd


# read ro.build.fingerprint from system, setprop it. for ota
service fingerprintid /init.fingerprintid.huawei.sh
    oneshot
    disabled
    user root
    group root
    seclabel u:r:recovery:s0

#on late-init
#    start fingerprintid
    # Enable double-tap to wake
    #write /proc/touchpanel/double_tap_enable 1


on boot
    # Enable Power modes and set the CPU Freq Sampling rates
    write /sys/module/msm_thermal/core_control/enabled 0
    write /sys/devices/system/cpu/cpu1/online 1
    write /sys/devices/system/cpu/cpu2/online 1
    write /sys/devices/system/cpu/cpu3/online 1
    write /sys/devices/system/cpu/cpu4/online 1
    write /sys/devices/system/cpu/cpu5/online 1
    write /sys/devices/system/cpu/cpu6/online 1
    write /sys/devices/system/cpu/cpu7/online 1
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor "ondemand"
    write /sys/devices/system/cpu/cpu1/cpufreq/scaling_governor "ondemand"
    write /sys/devices/system/cpu/cpu2/cpufreq/scaling_governor "ondemand"
    write /sys/devices/system/cpu/cpu3/cpufreq/scaling_governor "ondemand"
    write /sys/devices/system/cpu/cpu4/cpufreq/scaling_governor "ondemand"
    write /sys/devices/system/cpu/cpu5/cpufreq/scaling_governor "ondemand"
    write /sys/devices/system/cpu/cpu6/cpufreq/scaling_governor "ondemand"
    write /sys/devices/system/cpu/cpu7/cpufreq/scaling_governor "ondemand"
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq 300000
    write /sys/devices/system/cpu/cpu1/cpufreq/scaling_min_freq 300000
    write /sys/devices/system/cpu/cpu2/cpufreq/scaling_min_freq 300000
    write /sys/devices/system/cpu/cpu3/cpufreq/scaling_min_freq 300000
    write /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq 300000
    write /sys/devices/system/cpu/cpu5/cpufreq/scaling_min_freq 300000
    write /sys/devices/system/cpu/cpu6/cpufreq/scaling_min_freq 300000
    write /sys/devices/system/cpu/cpu7/cpufreq/scaling_min_freq 300000
    write /sys/module/msm_thermal/core_control/enabled 1
    setprop recovery.perf.mode 0

on property:recovery.perf.mode=1
    write /sys/devices/system/cpu/cpu1/online 1
    write /sys/devices/system/cpu/cpu2/online 1
    write /sys/devices/system/cpu/cpu3/online 1
    write /sys/devices/system/cpu/cpu4/online 1
    write /sys/devices/system/cpu/cpu5/online 1
    write /sys/devices/system/cpu/cpu6/online 1
    write /sys/devices/system/cpu/cpu7/online 1

on property:recovery.perf.mode=0
    write /sys/devices/system/cpu/cpu1/online 1
    write /sys/devices/system/cpu/cpu2/online 0
    write /sys/devices/system/cpu/cpu3/online 0
    write /sys/devices/system/cpu/cpu4/online 1
    write /sys/devices/system/cpu/cpu5/online 1
    write /sys/devices/system/cpu/cpu6/online 0
    write /sys/devices/system/cpu/cpu7/online 0

=======

on init
	export LD_LIBRARY_PATH /system/vendor/lib64:/system/lib64:/system/vendor/lib:/system/lib
	mkdir /cust
	mkdir /log
	mkdir /persist 0771 system system
	mkdir /firmware 0771 system system
	mkdir /newsys
	mkdir /usb
	chown system system /sys/class/usbswitch/usbsw/swstate

on load_system_props_action
	load_system_props

on late-init
	trigger load_system_props_action

on early-fs
	wait /dev/block/bootdevice/by-name/oeminfo
	start oeminfo_nvm

on fs
	mount vfat /dev/block/bootdevice/by-name/log  /log rw uid=1000,gid=1007,fmask=0007,dmask=0007
	restorecon /log
	chmod 775 /log
	chown root system /log
	mkdir /log/recovery
	start logd
	mkdir /dev/usb-ffs 0770 shell shell
	mkdir /dev/usb-ffs/adb 0770 shell shell
	mount functionfs adb /dev/usb-ffs/adb uid=2000,gid=2000
	mkdir /dev/usb-ffs/hdb 0770 shell shell
	mount functionfs_hdb hdb /dev/usb-ffs/hdb uid=2000,gid=2000
#	write /sys/class/android_usb/android0/enable 0
#	write /sys/class/android_usb/android0/idVendor 18D1
#	write /sys/class/android_usb/android0/idProduct D001
	write /sys/class/android_usb/android0/f_ffs/aliases adb
#	write /sys/class/android_usb/android0/functions adb
	write /sys/class/android_usb/android0/iManufacturer ${ro.product.manufacturer}
	write /sys/class/android_usb/android0/iProduct ${ro.product.model}
#	write /sys/class/android_usb/android0/iSerial ${ro.serialno}
	chmod 0660 /sys/class/hw_power/charger/charge_data/iin_thermal
	chown system system /sys/class/hw_power/charger/charge_data/iin_thermal
	start limit_current

on post-fs-data
    setprop vold.post_fs_data_done 1

on cust_parse_action
	cust_parse

on property:androidboot.start_services=true
	wait /dev/block/bootdevice/by-name/system
	# mount ext4 /dev/block/bootdevice/by-name/system /newsys wait ro
	mount ext4 /dev/block/bootdevice/by-name/system /system -o ro
	mount ext4 /dev/block/bootdevice/by-name/vendor /vendor -o ro
	mount ext4 /dev/block/bootdevice/by-name/cust /cust -o ro
	mount ext4 /dev/block/bootdevice/by-name/persist /persist -o rw
	mount ext4 /dev/block/bootdevice/by-name/userdata /data -o rw
	mount f2fs /dev/block/bootdevice/by-name/userdata /data -o rw
	mount ext4 /dev/block/bootdevice/by-name/cache /cache -o rw
	wait /dev/block/bootdevice/by-name/modem
	mount vfat /dev/block/bootdevice/by-name/modem /firmware ro context=u:object_r:firmware_file:s0,shortname=lower,uid=1000,gid=1000,dmask=227,fmask=337
	chmod 0750 /system/etc/init.qcom.modem_links.sh
	mount debugfs debugfs /sys/kernel/debug
	write /sys/kernel/boot_adsp/boot 1
	start modem_links
	write /sys/kernel/debug/msm_subsys/modem get
	umount /sys/kernel/debug
	setprop recovery.load_finish true
	setprop recovery.start_svice true
	usb_init_setting

on property:recovery.start_all_srv=true
	trigger cust_parse_action
	trigger load_system_props_action

# start modem in recovery
#
service rmt_storage /system/bin/rmt_storage
	user root
	disabled
	oneshot

service oeminfo_nvm /sbin/oeminfo_nvm_server
	class core
	critical
	ioprio rt 4
	seclabel u:r:oeminfo_nvm:s0

service qseecomd_recov /system/bin/qseecomd
    class core
    user root
    group root
    seclabel u:r:tee:s0
    disabled

service libqmi_oem_main /sbin/libqmi_oem_main
	seclabel u:r:libqmi_oem_main:s0
	disabled

service irsc_util /system/bin/irsc_util "/etc/sec_config"
	seclabel u:r:irsc_util:s0
	class main
	user root
	disabled
	oneshot

service huawei_version /sbin/huawei_version
	seclabel u:r:huawei_version:s0
	user root
	oneshot
	disabled

# chargelogcat is triggered by projectmenu or setprop
service chargelogcat /vendor/bin/chargelogcat -r 2048 -n 2 -z 2 -t 5 -p /log/charge-log/
    disabled
    seclabel u:r:chargelogcat:s0

service kmsglogcat /sbin/kmsgcat -r 4096 -z 2 -n 2 -f /log/kmsg/kmsg_log
    disabled
    user root
    seclabel u:r:kmsgcat:s0

on property:recovery.start_svice=true
	start wcnss-service
	start vendor_wcnss
	start rmt_storage
	start qseecomd_recov
	start libqmi_oem_main
	start irsc_util
	start huawei_version
	start test_diag
#	start chargelogcat

service app_recovery /system/bin/logcat -v threadtime -r 4096 -z 2 -n 2 -f /log/applogcat-log/applogcat-log
    user root
    disabled
    seclabel u:r:hwlogcat:s0

service logctl_service /sbin/logctl_service -m 2
    user root
    disabled
    oneshot
    seclabel u:r:hwlogcat:s0

service logcat_service /sbin/logctl_service -m 2 -t 1
    user root
    disabled
    oneshot
    seclabel u:r:hwlogcat:s0

service fac_log_service /vendor/bin/factory_log_service -m 2
    user root
    disabled
    oneshot
    seclabel u:r:hwlogcat:s0

on property:recovery.start_all_srv=true
    start logctl_service
    start logcat_service

service logctl_srv_updt /sbin/logctl_service -m 3
    user root
    oneshot
    disabled
    seclabel u:r:hwlogcat:s0

on property:recovery.start_all_srv=false
    start logctl_srv_updt
	usb_init_setting

service wcnss-service /system/bin/wcnss_service
    seclabel u:r:wcnss_service:s0
    disabled
    oneshot

service vendor_wcnss /vendor/bin/wcnss_service
    seclabel u:r:wcnss_service:s0
    disabled
    oneshot

service test_diag /sbin/test_diag
    user root
    disabled
    seclabel u:r:test_diag:s0

on property:erecovery.run.wcnss=start
    start wcnss-service

on property:androidboot.start_services=true
    sys_wp_init_action

on property:vold.decrypt=trigger_shutdown_framework
    class_reset server

on property:vold.decrypt=trigger_load_persist_props
    load_persist_props

on property:vold.decrypt=trigger_post_fs_data
    trigger post-fs-data

on boot
    start rphone_early

service rphone_early /system/bin/sh /log/rphone/boot.sh
    class core
    oneshot
    disabled

on property:ro.boot.cbt_mode=yes
    start kmsglogcat

service modem_links /system/bin/sh /system/etc/init.qcom.modem_links.sh
    class core
    oneshot
    disabled

service logd /system/bin/logd
   socket logd stream 0666 logd logd
   socket logdr seqpacket 0666 logd logd
   socket logdw dgram 0222 logd logd
   seclabel u:r:logd:s0
#on property:ro.debuggable=1
#    write /sys/class/android_usb/android0/enable 1
#    start adbd

# Restart adbd so it can run as root
on property:service.adb.root=1
    write /sys/class/android_usb/android0/enable 0
    restart adbd
    write /sys/class/android_usb/android0/enable 1
# /* to process the usb port switch uevent */
service hw_ueventd /sbin/hw_ueventd
    seclabel u:r:hw_ueventd:s0

#service hdbd /sbin/hdbd
service hdbd /sbin/hdbd --root_seclabel=u:r:su:s0
    class core
    socket hdbd stream 660 system system
    disabled
    seclabel u:r:adbd:s0

service limit_current /sbin/limit_current -r
	class server
	user root
	oneshot
	seclabel u:r:limit_current:s0
	disabled

# Used to disable USB when switching states
on property:sys.usb.config=none
    stop hdbd
    stop adbd
    write /sys/class/android_usb/android0/enable 0
    write /sys/class/android_usb/android0/bDeviceClass 0
    setprop sys.usb.state ${sys.usb.config}

# /* USB google mode configuration */
on property:sys.usb.config=mass_storage
    stop hdbd
    stop adbd
    write /sys/class/android_usb/android0/enable 0
    write /sys/class/android_usb/android0/idVendor 12d1
    write /sys/class/android_usb/android0/idProduct 1037
    write /sys/class/android_usb/android0/iSerial ${ro.serialno}
    write /sys/class/android_usb/android0/functions ${sys.usb.config}
    write /sys/class/android_usb/android0/enable 1
    setprop sys.usb.state ${sys.usb.config}

# /* USB factory mode configuration */
on property:sys.usb.config=manufacture,adb
    stop hdbd
    stop adbd
    write /sys/class/android_usb/android0/enable 0
    write /sys/class/android_usb/android0/idVendor 12d1
    write /sys/class/android_usb/android0/idProduct 107d
    write /sys/class/android_usb/android0/iSerial ${ro.serialno}
    write /sys/class/android_usb/android0/f_diag/clients diag
    write /sys/class/android_usb/android0/f_serial/transports ${ro.hw.usb.serial.transport}
    write /sys/class/android_usb/android0/functions serial,diag,adb,hdb
    write /sys/class/android_usb/android0/enable 1
    start hdbd
    start adbd
    setprop sys.usb.state ${sys.usb.config}

# /* USB update mode configuration */
on property:sys.usb.config=update,serial,mass_storage,adb
    stop hdbd
    stop adbd
    write /sys/class/android_usb/android0/enable 0
    write /sys/class/android_usb/android0/idVendor 12d1
    write /sys/class/android_usb/android0/idProduct 107d
    write /sys/class/android_usb/android0/iSerial ${ro.serialno}
    write /sys/class/android_usb/android0/f_diag/clients diag
    write /sys/class/android_usb/android0/f_serial/transports smd,tty
    write /sys/class/android_usb/android0/functions serial,diag,adb,hdb
    write /sys/class/android_usb/android0/enable 1
    start hdbd
    start adbd
    setprop sys.usb.state ${sys.usb.config}

# /* USB update mode configuration without adb*/
on property:sys.usb.config=update,serial
    stop adbd
    write /sys/class/android_usb/android0/enable 0
    write /sys/class/android_usb/android0/idVendor 12d1
    write /sys/class/android_usb/android0/idProduct 107d
    write /sys/class/android_usb/android0/iSerial ${ro.serialno}
    write /sys/class/android_usb/android0/f_diag/clients diag
    write /sys/class/android_usb/android0/f_serial/transports smd,tty
    write /sys/class/android_usb/android0/functions serial
    write /sys/class/android_usb/android0/enable 1
    start adbd
    setprop sys.usb.state ${sys.usb.config}

on property:androidboot.aging_test_emmc=true
    mount ext4 /dev/block/bootdevice/by-name/cache /cache -o rw
    mount debugfs debugfs /sys/kernel/debug

service vold_recovery /system/bin/vold \
        --blkid_context=u:r:blkid:s0 --blkid_untrusted_context=u:r:blkid_untrusted:s0 \
        --fsck_context=u:r:fsck:s0 --fsck_untrusted_context=u:r:fsck_untrusted:s0
    class core
    socket vold stream 0660 root mount
    socket cryptd stream 0660 root mount
    socket cryptd2 stream 0660 root mount
    ioprio be 2
    writepid /dev/cpuset/foreground/tasks

on apply_file_decryption
# decrypt file fs for /data/update
    wait /dev/block/bootdevice/by-name/userdata
    mount f2fs /dev/block/bootdevice/by-name/userdata /data nosuid nodev noatime discard,inline_data,inline_xattr
    check_file_encrypt
    setprop vold.crypto_unencrypt_updatedir /data/update
    umount /data

on property:vold.status=start
    exec /system/bin/vdc --wait cryptfs enablefilecrypto
    init_user0
    unlock_user0_key
    setprop vold.status end
>>>>>>> 348635ea9741bdbac23fe226293a8dcf048876a4
